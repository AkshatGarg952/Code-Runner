================================================================================
                    CODE-RUNNER: HOW IT WORKS
================================================================================

ğŸ“Œ WHAT IS CODE-RUNNER?
------------------------
Code-Runner is a web service that lets you execute code in 9 different 
programming languages safely and get results. Think of it as a "code executor 
as a service."


ğŸ”„ THE FLOW (Step-by-Step)
---------------------------

1. USER SENDS CODE
   - You send a POST request to the server with:
     * Your code (e.g., Python, C++, Java, etc.)
     * The programming language
     * Test cases (input/output pairs)

2. SERVER RECEIVES & VALIDATES
   - index.js receives your request
   - Validation middleware checks:
     âœ“ Is the code present?
     âœ“ Is the language supported?
     âœ“ Are test cases valid?
   - If invalid â†’ Returns error immediately

3. SECURITY CHECKS
   - Rate limiter checks: "Have you made too many requests?"
   - CORS checks: "Are you allowed to access this API?"
   - If failed â†’ Returns error

4. CODE SENT TO JUDGE0
   - helper.js takes your code
   - Sends it to Judge0 API (external service on RapidAPI)
   - Judge0 runs your code in a secure sandbox
   - Waits for result (polls every 1 second, max 30 seconds)

5. JUDGE0 EXECUTES CODE
   - Runs your code with the test input
   - Captures the output
   - Checks for errors (compilation, runtime, timeout, etc.)

6. COMPARE RESULTS
   - helper.js compares actual output vs expected output
   - Normalizes whitespace/newlines for fair comparison
   - If match â†’ Test passed âœ“
   - If no match â†’ Test failed âœ—

7. RETURN RESPONSE
   - Server sends back result:
     * Success: "All test cases passed!"
     * Error: Details about what went wrong


ğŸ—ï¸ ARCHITECTURE
----------------

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚  (You send HTTP request)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Express Server (index.js)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. CORS Middleware                â”‚ â”‚
â”‚  â”‚  2. Rate Limiter                   â”‚ â”‚
â”‚  â”‚  3. Request Logger (Morgan)        â”‚ â”‚
â”‚  â”‚  4. Body Parser                    â”‚ â”‚
â”‚  â”‚  5. Validation Middleware          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Helper Functions (helper.js)      â”‚
â”‚  - executeCode()                        â”‚
â”‚  - executeSingleTest()                  â”‚
â”‚  - executeCustomTests()                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Judge0 API (RapidAPI)           â”‚
â”‚  - Receives code + language ID          â”‚
â”‚  - Executes in secure sandbox           â”‚
â”‚  - Returns output/errors                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ“ FILE STRUCTURE
-----------------

index.js
  â””â”€> Main server file
  â””â”€> Defines all API endpoints (/run, /submit, /health, etc.)
  â””â”€> Sets up middleware (CORS, rate limiting, logging)

helper.js
  â””â”€> Contains code execution logic
  â””â”€> Communicates with Judge0 API
  â””â”€> Handles error mapping and output comparison

config.js
  â””â”€> Loads environment variables
  â””â”€> Validates required configuration
  â””â”€> Exports settings (port, API keys, limits)

middleware/validator.js
  â””â”€> Validates incoming requests
  â””â”€> Checks language support
  â””â”€> Ensures required fields are present

.env
  â””â”€> Stores sensitive configuration
  â””â”€> API keys, URLs, rate limits


ğŸ›£ï¸ API ENDPOINTS
-----------------

1. GET /health
   â†’ Check if server is running
   â†’ Returns: status, timestamp, uptime

2. POST /run
   â†’ Run code against sample test cases
   â†’ Returns: pass/fail with details

3. POST /submit
   â†’ Run code against all test cases (including hidden)
   â†’ Returns: pass/fail with details

4. POST /run-all
   â†’ Run all tests and get statistics
   â†’ Returns: total tests, passed count

5. POST /run-custom-tests
   â†’ Run code with your own test inputs
   â†’ Returns: output for each input


ğŸ” SECURITY FEATURES
--------------------

âœ“ Rate Limiting
  - Prevents abuse (default: 100 requests/minute)
  - Configurable via environment variables

âœ“ Input Validation
  - All requests validated before processing
  - Prevents malformed data from reaching Judge0

âœ“ CORS Protection
  - Controls which websites can access the API
  - Configurable allowed origins

âœ“ Request Logging
  - All requests logged for monitoring
  - Helps debug issues

âœ“ Sandboxed Execution
  - Code runs in Judge0's isolated environment
  - Cannot access your server or data


ğŸŒ SUPPORTED LANGUAGES (9 Total)
---------------------------------

1. Python 3
2. C++ (C++17)
3. Java (OpenJDK 17)
4. JavaScript (Node.js)
5. C (GCC)
6. C# (Mono)
7. Ruby
8. Go
9. Rust


âš™ï¸ HOW JUDGE0 WORKS
-------------------

Judge0 is a separate service that:
  1. Receives your code and language ID
  2. Compiles it (if needed)
  3. Runs it in a Docker container (isolated)
  4. Sets time and memory limits
  5. Captures output and errors
  6. Returns everything back to your server

You're using Judge0 via RapidAPI (hosted version).


ğŸ”„ ERROR HANDLING
-----------------

The system handles these errors:

âœ— Compilation Error
  â†’ Your code has syntax errors

âœ— Runtime Error
  â†’ Code crashes while running (e.g., division by zero)

âœ— Time Limit Exceeded
  â†’ Code took too long to execute

âœ— Memory Limit Exceeded
  â†’ Code used too much memory

âœ— Wrong Answer
  â†’ Output doesn't match expected result

âœ— System Error
  â†’ Problem with Judge0 or network


ğŸ“Š EXAMPLE REQUEST/RESPONSE
----------------------------

REQUEST:
POST http://localhost:9000/run
{
  "code": "print('Hello')",
  "language": "python",
  "problem": {
    "examples": [
      {"input": "", "output": "Hello"}
    ]
  }
}

RESPONSE (Success):
{
  "isError": false,
  "message": "All test cases passed successfully"
}

RESPONSE (Error):
{
  "isError": true,
  "errorType": "Wrong Answer",
  "message": "Output did not match expected result",
  "result": {"input": ""}
}


ğŸ’¡ KEY CONCEPTS
---------------

1. Polling
   - After sending code to Judge0, we check status every 1 second
   - Max wait: 30 seconds
   - Prevents hanging if Judge0 is slow

2. Output Normalization
   - Removes extra spaces/newlines before comparing
   - Makes comparison fair (ignores formatting differences)

3. Language Mapping
   - Each language has a Judge0 ID (e.g., Python = 71)
   - helper.js maps language names to IDs

4. Test Cases
   - Sample tests: Visible to user, for quick validation
   - Hidden tests: Only for final submission, ensures correctness


ğŸš€ QUICK START
--------------

1. Install dependencies:
   npm install

2. Add Judge0 API key to .env:
   JUDGE0_API_KEY=your_key_here

3. Start server:
   npm start

4. Test it:
   curl http://localhost:9000/health


ğŸ“ CONFIGURATION (.env file)
-----------------------------

PORT=9000
  â†’ Server runs on this port

JUDGE0_API_KEY=xxx
  â†’ Your RapidAPI key for Judge0

JUDGE0_API_URL=https://judge0-ce.p.rapidapi.com/submissions
  â†’ Judge0 API endpoint

RATE_LIMIT_WINDOW_MS=60000
  â†’ Rate limit time window (60 seconds)

RATE_LIMIT_MAX_REQUESTS=100
  â†’ Max requests per window


ğŸ¯ SUMMARY
----------

Code-Runner is a middleware service that:
  âœ“ Accepts code from users
  âœ“ Validates and secures requests
  âœ“ Sends code to Judge0 for execution
  âœ“ Compares results with expected output
  âœ“ Returns pass/fail response

It's like a bridge between your application and Judge0, adding security,
validation, and convenience features.


================================================================================
                            END OF DOCUMENT
================================================================================
